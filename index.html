<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .container {
            text-align: center;
            max-width: 100%;
            overflow: auto;
            padding: 20px;
        }

        .svg-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 20px;
            margin: 0 auto;
            width: 95vw;
            height: 75vh;
            overflow: auto;
            position: relative;
        }

        .svg-container svg {
            width: 100%;
            height: auto;
            display: block;
        }

        h1 {
            color: #333;
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
            margin-top: 10px;
            opacity: 0.8;
        }


        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #666;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error-message {
            color: #e74c3c;
            background: #fdf2f2;
            border: 1px solid #fcc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>–ì–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ —Å–µ–º—å–∏</h1>
        <p class="subtitle">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–µ–º–µ–π–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏</p>
    </div>

    <div class="container">
        <div class="svg-container" id="svgContainer">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –≥–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –¥–µ—Ä–µ–≤–∞...</p>
            </div>


        </div>
    </div>
    <script>
        let currentZoom = 1;
        let isDragging = false;
        let translateX = 0;
        let translateY = 0;
        let startX, startY, initialTranslateX, initialTranslateY;

        // –ó–∞–≥—Ä—É–∑–∫–∞ SVG —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
        async function loadSVG() {
            const container = document.getElementById('svgContainer');

            try {
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
                const timestamp = new Date().getTime();
                const response = await fetch(`family_tree_vector.svg?t=${timestamp}`, {
                    cache: 'no-cache',
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });

                if (response.ok) {
                    const svgText = await response.text();
                    container.innerHTML = svgText;

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è SVG –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                    const svg = document.querySelector('svg');
                    if (svg) {
                        svg.setAttribute('width', '100%');
                        svg.setAttribute('height', 'auto');
                        svg.style.display = 'block';
                        svg.style.transformOrigin = 'center center';

                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                        addInteractionHandlers(svg);

                        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫ —É–∑–ª–∞–º –ø–µ—Ä—Å–æ–Ω
                        addPersonClickHandlers(svg);

                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
                        showNotification('–ì–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –ª—é–±–æ–π –ø–µ—Ä—Å–æ–Ω–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–∏—á–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.', 'success');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ SVG:', error);
                container.innerHTML = `
                    <div class="error-message">
                        <h3>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ä–µ–≤–∞</h3>
                        <p><strong>–§–∞–π–ª family_tree_vector.svg –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω.</strong></p>
                        <p>–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:</p>
                        <ul style="text-align: left; display: inline-block;">
                            <li>–ó–∞–ø—É—Å—Ç–∏—Ç–µ <code>python3 main.py</code> –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ä–µ–≤–∞</li>
                            <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª source.txt —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ</li>
                            <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Graphviz</li>
                        </ul>
                        <button onclick="location.reload()" style="margin-top: 15px; background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">
                            üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        </button>
                    </div>
                `;
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–ª–∏–∫–æ–≤ –Ω–∞ –ø–µ—Ä—Å–æ–Ω
        function addPersonClickHandlers(svg) {
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —É–∑–ª—ã —Å –ø–µ—Ä—Å–æ–Ω–∞–º–∏ (–∏—Å–∫–ª—é—á–∞—è —É–∑–ª—ã –±—Ä–∞–∫–æ–≤)
            const personNodes = svg.querySelectorAll('g.node:not([id*="marriage"])');

            personNodes.forEach(node => {
                const nodeId = node.getAttribute('id');
                if (nodeId && !nodeId.includes('marriage')) {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                    node.style.cursor = 'pointer';
                    node.style.transition = 'all 0.3s ease';

                    // –î–æ–±–∞–≤–ª—è–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç
                    node.addEventListener('mouseenter', function () {
                        this.style.filter = 'drop-shadow(0 0 10px rgba(102, 126, 234, 0.6))';
                        this.style.strokeWidth = '3';
                        this.style.fontWeight = 'bold';
                    });

                    node.addEventListener('mouseleave', function () {
                        this.style.filter = 'none';
                        this.style.strokeWidth = '';
                        this.style.fontWeight = '';
                    });

                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                    node.addEventListener('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();

                        // –ò–∑–≤–ª–µ–∫–∞–µ–º ID –ø–µ—Ä—Å–æ–Ω—ã –∏–∑ ID —É–∑–ª–∞
                        const personId = nodeId;
                        openPersonPage(personId);
                    });

                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç—É–ª—Ç–∏–ø —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π
                    const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                    title.textContent = '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–µ—Ä—Å–æ–Ω—ã';
                    node.appendChild(title);
                }
            });
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä—Å–æ–Ω—ã
        function openPersonPage(personId) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            showNotification('–û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–µ—Ä—Å–æ–Ω—ã...', 'info');

            // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–µ—Ä—Å–æ–Ω—ã –≤ —Ç–æ–π –∂–µ –≤–∫–ª–∞–¥–∫–µ
            window.location.href = `person.html?id=${personId}`;
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –∏ –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            const styles = {
                success: { bg: '#4CAF50', icon: '‚úÖ' },
                error: { bg: '#f44336', icon: '‚ùå' },
                warning: { bg: '#ff9800', icon: '‚ö†Ô∏è' },
                info: { bg: '#667eea', icon: '‚ÑπÔ∏è' }
            };

            const style = styles[type] || styles.info;

            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${style.bg};
                color: white;
                padding: 15px 20px;
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
                z-index: 1000;
                font-weight: 500;
                font-size: 14px;
                transform: translateX(100%);
                transition: all 0.3s ease;
                max-width: 350px;
                word-wrap: break-word;
                display: flex;
                align-items: center;
                gap: 10px;
            `;

            notification.innerHTML = `
                <span style="font-size: 16px;">${style.icon}</span>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);

            // –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ SVG
        function updateTransform(svg) {
            svg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentZoom})`;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
        function addInteractionHandlers(svg) {
            const container = document.getElementById('svgContainer');

            // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–µ—Å–æ–º –º—ã—à–∏
            container.addEventListener('wheel', function (e) {
                e.preventDefault();

                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                currentZoom *= delta;
                currentZoom = Math.max(0.1, Math.min(5, currentZoom));

                updateTransform(svg);
            });

            // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –ª–µ–≤–æ–π –∫–Ω–æ–ø–∫–∏ –º—ã—à–∏
            container.addEventListener('mousedown', function (e) {
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                initialTranslateX = translateX;
                initialTranslateY = translateY;
                container.style.cursor = 'grabbing';
                e.preventDefault();
            });

            container.addEventListener('mouseleave', function () {
                isDragging = false;
                container.style.cursor = 'grab';
            });

            container.addEventListener('mouseup', function () {
                isDragging = false;
                container.style.cursor = 'grab';
            });

            container.addEventListener('mousemove', function (e) {
                if (!isDragging) return;
                e.preventDefault();

                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;

                translateX = initialTranslateX + deltaX;
                translateY = initialTranslateY + deltaY;

                updateTransform(svg);
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            container.style.cursor = 'grab';
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º SVG –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', loadSVG);
    </script>
</body>

</html>